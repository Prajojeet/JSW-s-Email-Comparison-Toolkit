<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Email Comparison Tool</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50">
  <div class="max-w-6xl mx-auto p-6">
    <!-- Header with logo -->
    <header class="bg-indigo-600 text-white rounded-xl p-4 shadow flex items-center gap-3">
      <img src="/static/logo.png" alt="JSW Logo" class="h-9 w-auto">
      <h1 class="text-2xl font-semibold">Email Comparison Tool</h1>
    </header>

    <!-- Input areas -->
    <div class="mt-6 grid md:grid-cols-2 gap-6">
      <!-- Original Document -->
      <div class="bg-white rounded-xl shadow p-4">
        <h2 class="flex items-center gap-2 font-medium text-indigo-700 mb-2">
          <span class="material-icons">description</span>
          Original Document
        </h2>
        <textarea id="orig" rows="14" class="w-full border rounded-lg p-3" placeholder="Paste your original well indented Document here from MS Word Offline version"></textarea>
      </div>

      <!-- Email Text -->
      <div class="bg-white rounded-xl shadow p-4">
        <h2 class="flex items-center gap-2 font-medium text-indigo-700 mb-2">
          <span class="material-icons">mail</span>
          Email Text
        </h2>
        <textarea id="email" rows="14" class="w-full border rounded-lg p-3" placeholder="Paste the email text here"></textarea>
      </div>
    </div>

    <!-- Action buttons -->
    <div class="mt-4 flex gap-3">
      <button id="run" class="px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700">Run Comparison</button>
      <button id="copy" class="px-4 py-2 rounded-lg bg-slate-200 hover:bg-slate-300" disabled>Copy Output</button>
    </div>

    <!-- Output -->
    <section class="mt-6 bg-white rounded-xl shadow p-4">
      <h2 class="font-medium text-purple-700 mb-2">Server Response (Processed Result)</h2>
      <div id="status" class="hidden mb-3 p-3 rounded border"></div>
      <div id="out" class="min-h-[120px] border rounded p-3 overflow-auto"></div>
    </section>
  </div>

  <script>
    const API_BASE = ""; // same origin, since frontend & backend are served together

    const runBtn = document.getElementById('run');
    const copyBtn = document.getElementById('copy');
    const out = document.getElementById('out');
    const status = document.getElementById('status');

    function showStatus(msg, ok=false) {
      status.className = "mb-3 p-3 rounded border " + 
        (ok ? "border-green-300 bg-green-50 text-green-700" : "border-red-300 bg-red-50 text-red-700");
      status.textContent = msg;
      status.classList.remove('hidden');
    }

    runBtn.onclick = async () => {
      status.classList.add('hidden');
      out.innerHTML = "Processing...";
      copyBtn.disabled = true;

      const payload = {
        original_text: document.getElementById('orig').value,
        email_text: document.getElementById('email').value
      };

      try {
        const r = await fetch((API_BASE || "") + "/compare", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const html = await r.text();

        if (!r.ok) {
          showStatus(`API call failed (HTTP ${r.status}).`, false);
          out.textContent = "";
          return;
        }

        out.innerHTML = html;
        copyBtn.disabled = false;
        showStatus("Success", true);
      } catch (e) {
        showStatus(`Network error: ${e.message}`, false);
        out.textContent = "";
      }
    };

    copyBtn.onclick = async () => {
    const html = out.innerHTML;                    // what you rendered
    const plain = out.innerText;                   // fallback

    try {
        // Modern way: copy rich HTML + a plain-text fallback
        const item = new ClipboardItem({
        "text/html": new Blob([html], { type: "text/html" }),
        "text/plain": new Blob([plain], { type: "text/plain" })
        });
        await navigator.clipboard.write([item]);     // works on HTTPS or localhost
        copyBtn.textContent = "Copied!";
    } catch (err) {
        // Fallback for older browsers
        const range = document.createRange();
        range.selectNodeContents(out);
        const sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(range);
        document.execCommand("copy");
        sel.removeAllRanges();
        copyBtn.textContent = "Copied (fallback)!";
    }
    setTimeout(() => (copyBtn.textContent = "Copy Output with Formatting"), 1200);
    };

  </script>
</body>
</html>
